<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузка...</title>
</head>

<body>
    <div id="root">
        <img style="width: 200px" src="./preloader.webp" alt="">
    </div>

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #root {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #001d31;
        }
    </style>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (m, e, t, r, i, k, a) {
            m[i] = m[i] || function () { (m[i].a = m[i].a || []).push(arguments) };
            m[i].l = 1 * new Date();
            for (var j = 0; j < document.scripts.length; j++) { if (document.scripts[j].src === r) { return; } }
            k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)
        })
            (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

        ym(99889506, "init", {
            clickmap: true,
            trackLinks: true,
            accurateTrackBounce: true,
            webvisor: true
        });
    </script>
    <noscript>
        <div><img src="https://mc.yandex.ru/watch/99889506" style="position:absolute; left:-9999px;" alt="" /></div>
    </noscript>
    <!-- /Yandex.Metrika counter -->

    <script>
        // Инициализация скрипта
        const initButton = async () => {
            try {
                // Обработка query
                const getQuery = (key) => {
                    const params = new URLSearchParams(window.location.search);
                    return params.get(key);
                }

                // Получаем clientID
                const clientID = getQuery('yclid')

                // Запрашиваем ссылку
                const response = await fetch(`https://4rthteamtg.online/api/create?clientId=${clientID}`);

                // Проверяем успешность ответа
                if (!response.ok) {
                    throw new Error(`Ошибка при получении ссылки: ${response.status} ${response.statusText}`);
                }

                // Парсим JSON-ответ
                const { data: link } = await response.json(); // Дestructuring для получения значения по ключу "data"

                // Редирект на полученную ссылку
                if (link) {
                    ym(99889506, "init", {
                        clickmap: true,
                        trackLinks: true,
                        accurateTrackBounce: true,
                        webvisor: true,
                        // Добавляем функцию обратного вызова
                        callback: function () {
                            window.location.href = link;
                        }
                    });
                } else {
                    console.error("Ссылка не найдена.");
                }
            } catch (e) {
                console.error('Ошибка инициализации скрипта.', e);
            }
        }

        // Запуск
        initButton();
    </script>
</body>

</html>